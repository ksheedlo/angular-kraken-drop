/**
 * angular-kraken-drop v0.1.0
 * Copyright (c) 2014 Ken Sheedlo
 * @license MIT
 *
 * Made with love in Colorado by @kensheedlo
 */
!function(e){"use strict";function n(n,t){var a;return a={duplicate:t.hasOwnProperty("ksKrakenDuplicate"),accept:n.$eval(t.ksKrakenAccept),cancel:t.ksKrakenCancel,handle:t.ksKrakenHandle},t.ksKrakenOpts&&e.extend(a,n.$eval(t.ksKrakenOpts)),a}function t(n,t,a){e.isArray(n)?n.push(t):n[a]=t}function a(n,t){e.isArray(n)?n.splice(t,1):delete n[t]}e.module("ks.kraken-drop",[]).directive("ksKraken",["$compile",function(r){var c=0,i=null;return{restrict:"A",compile:function(l,o){var u,s,k,p=o.ksKraken,d=p.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),f=l.html();if(!d)throw new Error("[ks.kraken:badexpr] Expected ksKraken in form of '_item_ in _collection_', but got '"+p+"'.");u=d[2],d=d[1].match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),k=d[3]||d[1],s=d[2]||"$index";try{if(f=e.element(f.trim()),0===f.length)throw new Error("")}catch(h){f=e.element("<span>"+f+"</span>")}return l.html(""),function(l,o,p){var d,h,$,m,v=n(l,p),y=c++;d=function(e){return e===y?!1:v.accept?v.accept(i.item):!0},o.droppable({drop:function(e,n){var a=n.draggable.data("krakenkey");d(a)&&l.$apply(function(){t(l.$eval(u),i.item,i.key),i=null})}}),h=function(e,n){var t={revert:!0,revertDuration:0,zIndex:99999,start:function(){i={item:e,key:n}},stop:function(){i||v.duplicate||l.$apply(function(){a(l.$eval(u),n)})}};return v.cancel&&(t.cancel=v.cancel),v.handle&&(t.handle=v.handle),t},m=function(){e.forEach($,function(e){e.$destroy()}),$=[],o.html(""),e.forEach(l.$eval(u),function(e,n){var t=f.clone(),a=l.$new();a[k]=e,a[s]=n,r(t)(a),t.draggable(h(e,n)),t.data("krakenkey",y),o.append(t),$.push(a)})},l.$watchCollection(u,function(){m()})}}}}])}(angular);